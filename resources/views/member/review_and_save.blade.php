<style type="text/css">
	.spn_t{
		font-weight: bold;
		font-size: 14px;
	}
	.spn_txt{
		word-wrap:break-word;
		overflow: hidden;
	}
	.row_review{
		margin-top: -13px !important;
	}
	div#file {
		position: relative;
		overflow: hidden;
	}
	input#txt_photo {
		position: absolute;
		font-size: 50px;
		opacity: 0;
		right: 0;
		top: 0;
	}
</style>
<div class="row">
	<div class="col-sm-7" style="margin-top:-30px">
		<fieldset class="border p-2">
			<legend class="w-auto">Personal Information</legend>

			<div class="form-row lbl_color ">
				<div class="col-md-3">
					<span class="spn_t"><p>Full Name:</p></span>
				</div>
				<div class="col-md-9">
					<span class="spn_txt spn_full_name"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-3">
					<span class="spn_t "><p>Date of Birth :</p></span>
				</div>
				<div class="col-md-9">
					<span class="spn_txt spn_date_of_birth"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-3">
					<span class="spn_t"><p>Place of Birth :</p></span>
				</div>
				<div class="col-md-9">
					<span class="spn_txt spn_place_of_birth"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-3">
					<span class="spn_t"><p>Gender :</p></span>
				</div>
				<div class="col-md-9">
					<span class="spn_txt spn_gender"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-3">
					<span class="spn_t"><p>Civil Status :</p></span>
				</div>
				<div class="col-md-9">
					<span class="spn_txt spn_civil_status"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-3">
					<span class="spn_t"><p>Address :</p></span>
				</div>
				<div class="col-md-9">
					<span class="spn_txt spn_address"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-3">
					<span class="spn_t"><p>Mobile No :</p></span>
				</div>
				<div class="col-md-9">
					<span class="spn_txt spn_mobile_no"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-3">
					<span class="spn_t"><p>TIN :</p></span>
				</div>
				<div class="col-md-9">
					<span class="spn_txt spn_tin"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-3">
					<span class="spn_t"><p>Email :</p></span>
				</div>
				<div class="col-md-9">
					<span class="spn_txt spn_email"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-3">
					<span class="spn_t"><p>Religion:</p></span>
				</div>
				<div class="col-md-9">
					<span class="spn_txt spn_religion"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-6">
					<span class="spn_t"><p>Highest Educational Attainment:</p></span>
				</div>
				<div class="col-md-5">
					<span class="spn_txt spn_educ_att"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-3">
					<span class="spn_t"><p>Spouse:</p></span>
				</div>
				<div class="col-md-7">
					<span class="spn_txt spn_spouse"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-3">
					<span class="spn_t"><p>No of Dependents:</p></span>
				</div>
				<div class="col-md-7">
					<span class="spn_txt spn_no_dep"><p></p></span>
				</div> 
			</div>
		</fieldset>
		<br>
		<fieldset class="border p-2">
			<legend class="w-auto">Financial Information</legend>
			<div class="form-row lbl_color row_review">
				<div class="col-md-5">
					<span class="spn_t"><p>Occupation/Source of Income:</p></span>
				</div>
				<div class="col-md-7">
					<span class="spn_txt spn_source_in"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-5">
					<span class="spn_t"><p>Annual Income:</p></span>
				</div>
				<div class="col-md-7">
					<span class="spn_txt spn_annual_in"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-3">
					<span class="spn_t"><p>Spouse Occupation:</p></span>
				</div>
				<div class="col-md-7">
					<span class="spn_txt spn_spouse_occ"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-4">
					<span class="spn_t"><p>Spouse Annual Income:</p></span>
				</div>
				<div class="col-md-7">
					<span class="spn_txt spn_spouse_annual_in"><p></p></span>
				</div> 
			</div>
		</fieldset>
		<br>
		<fieldset class="border p-2">
			<legend class="w-auto">Member Information</legend>
			<div class="form-row lbl_color row_review">
				<div class="col-md-3">
					<span class="spn_t"><p>Branch:</p></span>
				</div>
				<div class="col-md-9">
					<span class="spn_txt spn_branch"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-5">
					<span class="spn_t"><p>Membership Type:</p></span>
				</div>
				<div class="col-md-7">
					<span class="spn_txt spn_mem_type"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-5">
					<span class="spn_t"><p>Membership ID:</p></span>
				</div>
				<div class="col-md-7">
					<span class="spn_txt spn_membership_id"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-5">
					<span class="spn_t"><p>BOD Resolution no. :</p></span>
				</div>
				<div class="col-md-7">
					<span class="spn_txt spn_bod_resolution"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-5">
					<span class="spn_t"><p>Number of shares subscribe :</p></span>
				</div>
				<div class="col-md-7">
					<span class="spn_txt spn_no_shares"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-5">
					<span class="spn_t"><p>Amount per shares :</p></span>
				</div>
				<div class="col-md-7">
					<span class="spn_txt spn_amt_shares"><p></p></span>
				</div> 
			</div>
			<div class="form-row lbl_color row_review">
				<div class="col-md-5">
					<span class="spn_t"><p>Initial Capital paid-up :</p></span>
				</div>
				<div class="col-md-7">
					<span class="spn_txt spn_ini_cap"><p></p></span>
				</div> 
			</div>
		</fieldset>

	</div>
	<div class="col-sm-5">
		<div class="form-row lbl_color">
			<div class="form-group col-md-12">
				<?php
				$prev_image = ($image_path ?? "/storage/uploads/account_image/no_img.png");
				?>
				<div style="display: flex;justify-content: center;">
					<a href="{{$prev_image}}" data-toggle="lightbox" data-type="image" id="lightbox_preview">
						<img class="profile-user-img img-fluid center" src="{{$prev_image}}" alt="User profile picture" style="height:250px !important;width: 250px !important;" id="preview_image">
					</a>
				</div>
			</div>
			<div class="form-group col-md-12">
				<div style="display: flex;justify-content: center;">
					<div class="btn-group" role="group" aria-label="Button group with nested dropdown">
						<button type="button" class="btn btn-sm bg-gradient-info" onclick="$('#txt_photo').click()"><i class="fas fa-upload"></i>&nbsp;Upload Photo</button>
						<input type="file" name="file" id="txt_photo" style="display:none" />
						<button type="button" class="btn btn-sm bg-gradient-primary" onclick="show_modal_camera()"><i class="fas fa-camera"></i>&nbsp;Open Camera</button>

						<div class="btn-group" role="group">
							<button id="btnGroupDrop1" type="button" class="btn bg-gradient-danger dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								Options
							</button>
							<div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
								<a class="dropdown-item" onclick="remove_image()"><i class="fa fa-times"></i>&nbsp;&nbsp;Remove Image</a>
								@if($opcode == 1)
								<a class="dropdown-item" onclick="undo_image()"><i class="fas fa-undo"></i>&nbsp;&nbsp;Undo</a>
								@endif
							</div>
						</div>
					</div>
				</div>
				<br>
				<fieldset class="border p-2">
					<legend class="w-auto">Attachments</legend>
					<div class="form-row lbl_color ">
						<div class="col-md-6">
							<span class="spn_t"><p>Government Issued ID:</p></span>
						</div>
						<div class="col-md-6">
							<span class="spn_txt spn_gov_id"><img src="" height="20px" width="20px" style="margin-bottom:10px"> </span>
						</div> 
					</div>
					<div class="form-row lbl_color ">
						<div class="col-md-6">
							<span class="spn_t"><p>BOD Membership Resolution:</p></span>
						</div>
						<div class="col-md-6">
							<span class="spn_txt spn_bod_reso"><img src="/storage/uploads/icons/x.png" height="20px" width="20px" style="margin-bottom:10px"></span>
						</div> 
					</div>
				</fieldset>
			</div>
		</div>
	</div>
</div>
<div class="col-sm-12" style="margin-top:20px">
	<button type="button" class="btn btn-default prev-step bg-light round_button"><i class="fa fa-chevron-left"></i> Back</button>
	@if($opcode == 0 && $credential->is_create)
		<button class="btn bg-gradient-primary2 float-right round_button" id="btn_submit_member_add" style="margin-left:12px"><i class="fa fa-check"></i>&nbsp;Save and Add More</button>
	@endif
	@if(($opcode ==0 && $credential->is_create) || ($opcode == 1 && $credential->is_edit) || MySession::MemberCode() == $details->member_code )
	<button class="btn bg-gradient-success2 float-right round_button" id="btn_submit_member"><i class="fa fa-check"></i>&nbsp;Save</button>
	@endif
</div>

@push('scripts')
<script type="text/javascript">
	var attachment_icon_parent_path = "/storage/uploads/icons/";
	var image_via = 0; // 0 - upload ; 1 - webcam


	$(document).on('click', '[data-toggle="lightbox"]', function(event){
		event.preventDefault();

		$('#lightbox_preview').attr('href',$('#preview_image').attr('src'))

		$(this).ekkoLightbox();
	});

	function set_review_and_save(){
		$('.spn_full_name p').text($('#txt_first_name').val()+" "+$('#txt_middle_name').val()+" "+$('#txt_last_name').val()+" "+$('#txt_suffix').val());
		$('.spn_date_of_birth p').text(format_date($('#txt_birthdate').val()));
		$('.spn_place_of_birth p').text($('#txt_place_birth').val());
		$('.spn_gender p').text($("#sel_gender option:selected" ).text())
		$('.spn_civil_status p').text($("#sel_civil_status option:selected" ).text())
		$('.spn_address p').text($('#txt_address').val())
		$('.spn_mobile_no p').text($('#txt_mobile').val());
		$('.spn_tin p').text($('#txt_tin').val())
		$('.spn_email p').text($('#txt_email').val())
		$('.spn_religion p').text($('#txt_religion').val())
		$('.spn_educ_att p').text($('#sel_educ_att option:selected').text())
		$('.spn_spouse p').text($('#txt_spouse').val())
		$('.spn_no_dep p').text($('#txt_no_dependent').val())
		//Membership information
		$('.spn_branch p').text($('#sel_branch option:selected').text())
		$('.spn_mem_type p').text($('#sel_mem_type option:selected').text())	
		
		$mem_id_in = $.trim($('#txt_mem_id').val());

		$('.spn_membership_id p').text(($mem_id_in == "")?"Auto Generate":$mem_id_in);

		$('.spn_bod_resolution p').text($('#txt_bod_reso').val())
		$('.spn_no_shares p').text($('#txt_no_shares').val())
		$('.spn_amt_shares p').text("₱ "+$('#txt_amt_shares').val())
		$('.spn_ini_cap p').text("₱ "+$('#txt_in_capital').val())

		//Financial Information
		$('.spn_source_in p').text($('#sel_income_source').val())
		$('.spn_annual_in p').text("₱ "+$('#txt_annual_income').val())
	
		$('.spn_spouse_occ p').text($('#txt_spouse_occupation').val())
		$('.spn_spouse_annual_in p').text("₱ "+$('#txt_spouse_annual_income').val())

		var icon_gov;
		var icon_bod;


		if(opcode == 0){
			icon_gov = ($('#file_gov_id').val() == '')?'x.png':'check.png';
			icon_bod = ($('#file_bod_mem').val() == '')?'x.png':'check.png';
		}else{
			icon_gov = ($('#file_gov_id').length == 0 || ($('#file_gov_id').length > 0 && $('#file_gov_id').val() != ""))?'check.png':'x.png';
			icon_bod = ($('#file_bod_mem').length == 0 || ($('#file_bod_mem').length > 0 && $('#file_bod_mem').val() != ""))?'check.png':'x.png'
		}
		$('.spn_gov_id img').attr("src",attachment_icon_parent_path+icon_gov);
		$('.spn_bod_reso img').attr("src",attachment_icon_parent_path+icon_bod);
	}
	var no_image = '/storage/uploads/account_image/no_img.png';
	var last_photo = '<?php echo $prev_image; ?>';
	var is_remove_image = 0;
	$('#txt_photo').change(function(){
		var input = this;
		var url = $(this).val();
		console.log({url});
		var ext = url.substring(url.lastIndexOf('.') + 1).toLowerCase();
		if (input.files && input.files[0]&& (ext == "gif" || ext == "png" || ext == "jpeg" || ext == "jpg" || ext=="jfif")) 
		{
			var reader = new FileReader();
			reader.onload = function (e) {
				$('#preview_image').attr('src', e.target.result);
				$('#preview_image:not([src=""])').show();
			}
			reader.readAsDataURL(input.files[0]);
			is_remove_image  = 0;

			image_via = 0;

		}else if(url == ''){ //cancelled
			$(this).val('')
			return;
		}
		else
		{
			$(this).val('')
			Swal.fire({
				position: 'center',
				icon: 'warning',
				title: 'Please select valid image',
				showConfirmButton: false,
				cancelButtonText: `Close`,
				showCancelButton: true,
			})
		}
	});
	function remove_image(){
		$('#preview_image').attr('src', no_image);
		$('#txt_photo').val('');
		is_remove_image = 1;
		image_via = 0;
	}

	function append_beneficiary(){
		var out = `<tr class="row_beneficiaries">
		<td><input class="form-control frm-ben txt_ben_name" required></td>
		<td><input class="form-control frm-ben txt_ben_relationship" required></td>
		<td><a class="btn btn-xs btn-edit delete_row" title="Remove" onclick="delete_ben_row(this)"><i class="fa fa-times"></i>&nbsp;&nbsp;</a></td>
		</tr>`;

		$('#beneficiaries_body').append(out);
	}
	function delete_ben_row(obj){
		var parent_row = $(obj).closest("tr.row_beneficiaries")
		parent_row.remove();
	}
	function undo_image(){
		$('#preview_image').attr('src', last_photo);
		$('#txt_photo').val('');	
		is_remove_image = 0;
		image_via = 0;
	}
	function format_date(date,time){
		if(date == ""){
			return "";
		}
		time = (time == null)?'':time;
		var date = date +" "+time;
		var formattedDate = new Date(date);
		var out = {};

		const monthNames = ["January", "February", "March", "April", "May", "June",
		"July", "August", "September", "October", "November", "December"
		];

		out['day'] = formattedDate.getDate();
		out['month'] = monthNames[formattedDate.getMonth()];
		out['year'] =formattedDate.getFullYear();

		var time_format = "";
		if(time != ""){
			if (formattedDate.getHours()>=12){
				var hour = parseInt(formattedDate.getHours()) - 12;
				var amPm = "PM";
			} else {
				var hour = formattedDate.getHours(); 
				var amPm = "AM";
			}
			time_format = hour + ":" + ((formattedDate.getMinutes() < 10)?"0":"")+formattedDate.getMinutes() + " " + amPm;
		}
		return out['month']+" "+out['day']+", "+out['year']+" "+time_format;
	}
	$(document).on('click','#btn_submit_member,#btn_submit_member_add',function(e){
		// return;
		Swal.fire({
			title: 'Are you sure you want to save this ?',
			text: '',
			icon: 'warning',
			confirmButtonText: 'Yes',
			showCancelButton: true,
			confirmButtonColor: "#DD6B55"
		}).then((result) => {
			if (result.isConfirmed) {
				post($(e.target).attr('id'));
			}
		})
	})
</script>
@endpush
